import pytest
from agent_plugins.exploiters.zerologon.src.zerologon_options import ZerologonOptions

MAX_ATTEMPTS = 1001
ZER0LOGON_OPTIONS_DICT = {"max_attempts": MAX_ATTEMPTS}
ZEROLOGON_OPTIONS_OBJECT = ZerologonOptions(max_attempts=MAX_ATTEMPTS)

TOO_FEW_MAX_ATTEMPTS = 0
TOO_MANY_MAX_ATTEMPTS = 10000


def test_zerologon_options__serialization():
    assert ZEROLOGON_OPTIONS_OBJECT.model_dump(mode="json") == ZER0LOGON_OPTIONS_DICT


def test_smb_options__full_serialization():
    assert (
        ZerologonOptions(**ZEROLOGON_OPTIONS_OBJECT.model_dump(mode="json"))
        == ZEROLOGON_OPTIONS_OBJECT
    )


def test_zerologon_options__deserialization():
    assert ZerologonOptions(**ZER0LOGON_OPTIONS_DICT) == ZEROLOGON_OPTIONS_OBJECT


def test_zerologon_options__default():
    zerologon_options = ZerologonOptions()

    assert zerologon_options.max_attempts == 2000


@pytest.mark.parametrize(
    "max_attempts",
    [
        (TOO_FEW_MAX_ATTEMPTS),
        (TOO_MANY_MAX_ATTEMPTS),
    ],
)
def test_zerologon_options__constrains(max_attempts):
    with pytest.raises(ValueError):
        ZerologonOptions(max_attempts=max_attempts)
