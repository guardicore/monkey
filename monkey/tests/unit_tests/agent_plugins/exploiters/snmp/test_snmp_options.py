import pydantic
import pytest
from agent_plugins.exploiters.snmp.src.snmp_options import SNMPOptions

DOWNLOAD_TIMEOUT = 44


SNMP_OPTIONS_DICT = {
    "agent_binary_download_timeout": DOWNLOAD_TIMEOUT,
}


SNMP_OPTIONS_OBJECT = SNMPOptions(
    agent_binary_download_timeout=DOWNLOAD_TIMEOUT,
)

DOWNLOAD_TIMEOUT_EXCEPTION = {"agent_binary_download_timeout": -100}


def test_snmp_options__serialization():
    assert SNMP_OPTIONS_OBJECT.dict(simplify=True) == SNMP_OPTIONS_DICT


def test_hadoop_options__full_serialization():
    assert SNMPOptions(**SNMP_OPTIONS_OBJECT.dict(simplify=True)) == SNMP_OPTIONS_OBJECT


def test_hadoop_options__deserialization():
    assert SNMPOptions(**SNMP_OPTIONS_DICT) == SNMP_OPTIONS_OBJECT


def test_hadoop_options__default():
    snmp_options = SNMPOptions()

    assert snmp_options.agent_binary_download_timeout == 60.0


@pytest.mark.parametrize(
    "options_dict",
    [
        DOWNLOAD_TIMEOUT_EXCEPTION,
    ],
)
def test_hadoop_options_constrains(options_dict):
    with pytest.raises(pydantic.errors.NumberNotGtError):
        SNMPOptions(**options_dict)
