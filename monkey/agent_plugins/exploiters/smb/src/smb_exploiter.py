import logging
from typing import Iterable

from common.credentials import Credentials

from .smb_exploit_client import SMBExploitClient
from .smb_options import SMBOptions
from .smb_propagation_client import SMBPropagationClient

logger = logging.getLogger(__name__)


class SMBExploiter:
    def __init__(
        self,
        credentials: Iterable[Credentials],
        exploit_client: SMBExploitClient,
        propagation_client: SMBPropagationClient,
    ):
        self._credentials = credentials
        self._exploit_client = exploit_client
        self._propagation_client = propagation_client

    def exploit_host(self, host, options: SMBOptions):
        path = self._exploit_client.exploit(host, self._credentials, options)
        self._propagation_client.propagate(host, path, self._credentials)
