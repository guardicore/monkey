from ipaddress import IPv4Address
from typing import Optional, Sequence

from patlib import PurePath

from common import OperatingSystem

from .http_agent_binary_server import (
    AgentBinaryRequest,
    HTTPAgentBinaryServer,
    RequestID,
    RequestType,
)
from .i_http_agent_binary_server_registrar import IHTTPAgentBinaryServerRegistrar


class HTTPAgentBinaryServerRegistrar(IHTTPAgentBinaryServerRegistrar):
    def __init__(self, server: HTTPAgentBinaryServer):
        self._server = server

    def register_request(
        self,
        operating_system: OperatingSystem,
        request_type: RequestType,
        requestor_ip: IPv4Address,
        destination_path: Optional[PurePath] = None,
        args: Sequence[str] = [],
    ) -> AgentBinaryRequest:
        return self._server.register(
            operating_system, request_type, requestor_ip, destination_path, args
        )

    def deregister_request(self, request_id: RequestID):
        self._server.deregister(request_id)
