from common.agent_plugins import AgentPluginManifest, AgentPluginType

from .operating_system import OperatingSystem

HARD_CODED_EXPLOITER_MANIFESTS = {
    "ZerologonExploiter": AgentPluginManifest(
        name="ZerologonExploiter",
        plugin_type=AgentPluginType.EXPLOITER,
        supported_operating_systems=(OperatingSystem.LINUX, OperatingSystem.WINDOWS),
        target_operating_systems=(OperatingSystem.WINDOWS,),
        title="Zerologon Exploiter",
        version="1.0.0",
        description="Exploits a privilege escalation vulnerability (CVE-2020-1472) in a Windows "
        "server domain controller (DC) by using"
        " the Netlogon Remote Protocol (MS-NRPC). "
        "This exploiter changes the password of a Windows server DC account, steals "
        "credentials, and then attempts to restore the original DC password. The "
        "victim DC will be unable to communicate with other DCs until the original "
        "password has been restored. If Infection Monkey fails to restore the "
        "password automatically, you'll have to do it manually. For more "
        "information, see the documentation.",
        link_to_documentation="https://www.guardicore.com/infectionmonkey/docs/"
        "reference/exploiters/zerologon/",
        safe=False,
        remediation_suggestion="Install Windows security updates.\n\n"
        "The machine is vulnerable to a Zerologon exploit.\n"
        "This attack was possible because the latest security updates from Microsoft "
        "have not been applied to this machine. For more information about this vulnerability, "
        "see [this](https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2020-1472).",
    ),
    "Log4ShellExploiter": AgentPluginManifest(
        name="Log4ShellExploiter",
        plugin_type=AgentPluginType.EXPLOITER,
        supported_operating_systems=(OperatingSystem.LINUX, OperatingSystem.WINDOWS),
        target_operating_systems=(OperatingSystem.WINDOWS, OperatingSystem.LINUX),
        title="Log4Shell Exploiter",
        version="1.0.0",
        description="Exploits a software vulnerability (CVE-2021-44228) in Apache Log4j, a Java "
        "logging framework. Exploitation is attempted on the following services â€” "
        "Apache Solr, Apache Tomcat, Logstash.",
        link_to_documentation="https://www.guardicore.com/infectionmonkey/docs/reference"
        "/exploiters/log4shell/",
        safe=True,
        remediation_suggestion="Upgrade the Apache Log4j component to version 2.15.0 or later.\n\n"
        "The server is vulnerable to the Log4Shell remote code execution attack.\n"
        "This attack was possible due to an old version of Apache Log4j component "
        "([CVE-2021-44228](https://cve.mitre.org/cgi-bin/cvename.cgi?name=2021-44228)).",
    ),
    "SMBExploiter": AgentPluginManifest(
        name="SMBExploiter",
        plugin_type=AgentPluginType.EXPLOITER,
        supported_operating_systems=(OperatingSystem.LINUX, OperatingSystem.WINDOWS),
        target_operating_systems=(OperatingSystem.WINDOWS,),
        title="SMB Exploiter",
        version="1.0.0",
        description="Attempts a brute-force attack against SMB using known credentials",
        link_to_documentation="https://www.guardicore.com/infectionmonkey/docs/reference/"
        "exploiters/smbexec/",
        safe=True,
        remediation_suggestion="Change user passwords to a complex one-use password that is not "
        "shared with other computers on the network.\n\n"
        "The machine is vulnerable to an SMB attack.\n"
        "An Infection Monkey Agent authenticated over the SMB protocol.",
    ),
    "PowerShellExploiter": AgentPluginManifest(
        name="PowerShellExploiter",
        plugin_type=AgentPluginType.EXPLOITER,
        supported_operating_systems=(OperatingSystem.LINUX, OperatingSystem.WINDOWS),
        target_operating_systems=(OperatingSystem.WINDOWS,),
        title="PowerShell Remoting Exploiter",
        version="1.0.0",
        description="Exploits PowerShell remote execution setups. "
        "PowerShell Remoting uses Windows Remote Management (WinRM)"
        " to allow users to run PowerShell commands on remote computers.",
        link_to_documentation="https://www.guardicore.com/infectionmonkey/docs/reference/"
        "exploiters/powershell",
        safe=True,
        remediation_suggestion="Restrict PowerShell remote command execution and/or harden the "
        "credentials of relevant users.\n\n"
        "The machine is vulnerable to a PowerShell Remoting attack.\n"
        "This attack was possible because the target machine had PowerShell Remoting enabled "
        "and Infection Monkey had access to correct credentials.",
    ),
    "WmiExploiter": AgentPluginManifest(
        name="WmiExploiter",
        plugin_type=AgentPluginType.EXPLOITER,
        supported_operating_systems=(OperatingSystem.LINUX, OperatingSystem.WINDOWS),
        target_operating_systems=(OperatingSystem.WINDOWS,),
        title="WMI Exploiter",
        version="1.0.0",
        description="Attempts a brute-force attack against Windows Management Instrumentation "
        "(WMI) using known credentials",
        link_to_documentation="https://www.guardicore.com/infectionmonkey/docs/reference/"
        "exploiters/wmiexec/",
        safe=True,
        remediation_suggestion="Change user passwords to a complex one-use password that is not "
        "shared with other computers on the network.\n\n"
        "The machine is vulnerable to a WMI attack.\n"
        "An Infection Monkey Agent authenticated over the WMI protocol.",
    ),
    "MSSQLExploiter": AgentPluginManifest(
        name="MSSQLExploiter",
        plugin_type=AgentPluginType.EXPLOITER,
        supported_operating_systems=(OperatingSystem.LINUX, OperatingSystem.WINDOWS),
        target_operating_systems=(OperatingSystem.WINDOWS,),
        title="MSSQL Exploiter",
        version="1.0.0",
        description="Attempts a brute-force attack against Microsoft SQL using known "
        "credentials and uses insecure configuration to execute commands on the server.",
        link_to_documentation="https://www.guardicore.com/infectionmonkey/docs/reference/"
        "exploiters/mssql/",
        safe=True,
        remediation_suggestion="Disable the `xp_cmdshell` option.\n\n"
        "The machine is vulnerable to an MSSQL exploit.\n"
        "This attack was possible because the target machine used an outdated MSSQL server "
        "configuration allowing the usage of the `xp_cmdshell` command. To learn more about how "
        "to disable this feature, read [Microsoft's documentation](https://docs.microsoft.com/"
        "en-us/sql/database-engine/configure-windows/xp-cmdshell-server-configuration-option"
        "?view=sql-server-2017).",
    ),
    "SSHExploiter": AgentPluginManifest(
        name="SSHExploiter",
        plugin_type=AgentPluginType.EXPLOITER,
        supported_operating_systems=(OperatingSystem.LINUX, OperatingSystem.WINDOWS),
        target_operating_systems=(OperatingSystem.LINUX,),
        title="SSH Exploiter",
        version="1.0.0",
        description="Attempts a brute-force attack against SSH using known credentials, "
        "including SSH keys",
        link_to_documentation="https://www.guardicore.com/infectionmonkey/docs/reference/"
        "exploiters/sshexec/",
        safe=True,
        remediation_suggestion="Change user passwords to a complex one-use password that is not "
        "shared with other computers on the network. Protect private keys with a pass phrase.\n\n"
        "The machine is vulnerable to an SSH attack.\n"
        "An Infection Monkey Agent authenticated over the SSH protocol.",
    ),
}
