# Infection Monkey travis.yml. See Travis documentation for information about this file structure.

group: travis_latest
language: python
cache: pip
python:
- 3.7
install:
- pip install -r monkey/monkey_island/requirements.txt  # for unit tests
- pip install flake8 pytest dlint  # for next stages
- pip install -r monkey/infection_monkey/requirements_linux.txt  # for unit tests
before_script:
- flake8 . --count --select=E901,E999,F821,F822,F823 --show-source --statistics  # Check syntax errors
- flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics  # warn about linter issues. --exit-zero
  # means this stage will not fail the build. This is (hopefully) a temporary measure until all warnings are suppressed.
- python monkey/monkey_island/cc/set_server_config.py testing  # Set the server config to `testing`, for the UTs to use
  # mongomaock and pass.
script:
- cd monkey  # This is our source dir
- python -m pytest  # Have to use `python -m pytest` instead of `pytest` to add "{$builddir}/monkey/monkey" to sys.path.
notifications:
  slack:  # Notify to slack
      rooms:
      - infectionmonkey:QaXbsx4g7tHFJW0lhtiBmoAg#ci  # room: #ci
      on_success: change
      on_failure: always
  email:
      on_success: change
      on_failure: always
